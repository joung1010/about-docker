### 🚀 실습 준비

```bash
*# Docker daemon 연결 오류 발생*
$ docker pull nginx
Cannot connect to the Docker daemon at unix:///Users/jeonghwanpark/.docker/run/docker.sock. 
Is the docker daemon running?

*# Docker Desktop 실행으로 해결*
$ open -a docker
```

**`open -a docker` 명령어**:

- `open`: macOS에서 애플리케이션을 실행하는 명령어
- `a`: 애플리케이션 이름으로 실행하는 옵션
- `docker`: Docker Desktop 애플리케이션 실행

### 1️⃣ Nginx 이미지 다운로드

```bash
$ docker pull nginx
```

### **`docker pull` 명령어 상세 분석**

```
docker pull [OPTIONS] NAME[:TAG|@DIGEST]

기본 구조:
$ docker pull nginx
         ↓
실제로는: docker pull nginx:latest
         ↓
완전한 경로: docker pull docker.io/library/nginx:latest

구성 요소:
- docker.io: Docker Hub 레지스트리 (기본값)
- library: 공식 이미지 네임스페이스 (기본값)
- nginx: 이미지 이름
- latest: 태그 (버전, 기본값)
```

### **다운로드 과정**

```
실제 다운로드 출력:
Using default tag: latest
latest: Pulling from library/nginx
a2abf6c4d29d: Pull complete     ← 레이어 1 다운로드
66b1570312e7: Pull complete     ← 레이어 2 다운로드  
d42f3f394686: Pull complete     ← 레이어 3 다운로드
5abf8d4b4f40: Pull complete     ← 레이어 4 다운로드
f95f09b3c518: Pull complete     ← 레이어 5 다운로드
5f850b75b6ab: Pull complete     ← 레이어 6 다운로드
28d28b3f8e1f: Pull complete     ← 레이어 7 다운로드
Digest: sha256:2db21edf...        ← 이미지 무결성 체크섬
Status: Downloaded newer image for nginx:latest

각 레이어의 의미:
- 레이어 1-2: 베이스 OS (Debian 등)
- 레이어 3-4: 시스템 라이브러리 및 의존성
- 레이어 5-6: Nginx 바이너리 및 설정 파일
- 레이어 7: 기본 웹페이지 및 메타데이터
```

### **다양한 pull 옵션들**

```bash
특정 버전 다운로드:
$ docker pull nginx:1.21.6
$ docker pull nginx:alpine    *# 경량화 버전*

모든 태그 다운로드:
$ docker pull -a nginx

다른 레지스트리에서 다운로드:
$ docker pull gcr.io/project/image
$ docker pull amazonaws.com/image
```

### 2️⃣ 다운로드된 이미지 확인하기

bash

```bash
$ docker image ls
```

### **`docker image ls` 명령어 상세 분석**

```
출력 예시:
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    605c77e624dd   2 weeks ago    141MB

각 컬럼 설명:
- REPOSITORY: 이미지 이름 (nginx)
- TAG: 버전 태그 (latest)  
- IMAGE ID: 이미지 고유 식별자 (12자리 해시)
- CREATED: 이미지 생성 시점
- SIZE: 이미지 용량 (압축된 크기)
```

### **동일 명령어 다른 형태들**

```bash
같은 기능의 다른 명령어들:
$ docker image ls      *# 새로운 형태 (권장)*
$ docker images        *# 기존 형태 (호환성)*
$ docker image list    *# 완전한 형태*

유용한 옵션들:
$ docker image ls -a                    *# 중간 이미지까지 모두 표시*
$ docker image ls --no-trunc           *# IMAGE ID 전체 표시*
$ docker image ls --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"  *# 커스텀 포맷*
$ docker image ls --filter "dangling=true"  *# 태그 없는 이미지만 표시*
```

### **이미지 상세 정보 확인**

```bash
이미지 세부 정보 보기:
$ docker image inspect nginx

출력 예시 (일부):
[
    {
        "Id": "sha256:605c77e624dd...",
        "RepoTags": ["nginx:latest"],
        "RepoDigests": ["nginx@sha256:2db21edf..."],
        "Parent": "",
        "Comment": "",
        "Created": "2023-11-01T14:30:45Z",
        "Container": "...",
        "Config": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "80/tcp": {}          ← 기본 노출 포트
            },
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "NGINX_VERSION=1.25.3"
            ],
            "Cmd": [
                "nginx",
                "-g",
                "daemon off;"         ← 기본 실행 명령어
            ]
        },
        "Architecture": "amd64",
        "Os": "linux",
        "Size": 140869884,           ← 실제 크기 (바이트)
        "VirtualSize": 140869884
    }
]
```

### 3️⃣ 이미지를 컨테이너에 올려 Nginx 서버 실행시키기

```bash
$ docker run --name webserver -d -p 80:80 nginx
```

### **`docker run` 명령어 상세 분석**

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]

각 옵션 상세 설명:

--name webserver:
- 컨테이너에 이름 부여
- 없으면 Docker가 랜덤 이름 생성 (예: angry_einstein)
- 이름으로 컨테이너 참조 가능 (docker stop webserver)

-d (--detach):
- 백그라운드에서 실행 (데몬 모드)
- 터미널이 블로킹되지 않음
- 컨테이너 ID 반환 후 프롬프트 복귀

-p 80:80 (--publish):
- 포트 포워딩 설정
- 호스트포트:컨테이너포트
- 80:80 → localhost:80 → 컨테이너의 80포트
```

### **포트 매핑 상세**

```bash
포트 매핑 다양한 형태:
-p 80:80              *# 호스트 80 → 컨테이너 80*
-p 8080:80            *# 호스트 8080 → 컨테이너 80*
-p 127.0.0.1:80:80    *# 로컬호스트만 바인딩*
-p 80                 *# 컨테이너 80을 호스트 랜덤 포트에 바인딩*

여러 포트 매핑:
$ docker run -p 80:80 -p 443:443 nginx

포트 확인:
$ docker port webserver
80/tcp -> 0.0.0.0:80
```

### **실행 과정 내부 동작**

```
docker run 실행 시 내부 과정:

1. 이미지 확인:
   - 로컬에 nginx 이미지 존재 확인
   - 없으면 자동으로 docker pull nginx 실행

2. 컨테이너 생성:
   - 새로운 컨테이너 인스턴스 생성
   - 고유한 컨테이너 ID 할당
   - 이름 "webserver" 지정

3. 네트워크 설정:
   - 가상 네트워크 인터페이스 생성
   - IP 주소 할당 (예: 172.17.0.2)
   - 포트 포워딩 규칙 설정

4. 파일시스템 설정:
   - Copy-on-Write 레이어 생성
   - 이미지를 읽기 전용으로 마운트
   - 쓰기 가능한 레이어 추가

5. 프로세스 실행:
   - nginx 바이너리 실행
   - 네임스페이스 격리 적용
   - cgroups 리소스 제한 적용

출력:
3f4d8e92a45b8c7d6e1f9a2e5c8b4f7d9e3a6c1b5f8e2d4c7a9f6e3b1d8c5a7e
(컨테이너 ID 반환)
```

### **다양한 실행 옵션들**

```bash
자주 사용하는 옵션들:

환경 변수 설정:
$ docker run -e MYSQL_ROOT_PASSWORD=mypassword mysql

볼륨 마운트:
$ docker run -v /host/path:/container/path nginx
$ docker run -v my-volume:/data nginx

인터랙티브 모드:
$ docker run -it ubuntu /bin/bash
*# -i: 표준입력 열기# -t: TTY 할당*

메모리 제한:
$ docker run -m 512m nginx     *# 512MB 제한*

CPU 제한:
$ docker run --cpus="1.5" nginx  *# 1.5 코어 제한*

자동 삭제:
$ docker run --rm nginx        *# 컨테이너 종료 시 자동 삭제*

읽기 전용:
$ docker run --read-only nginx  *# 파일시스템 쓰기 금지*
```

### 4️⃣ Nginx 서버가 잘 실행되는지 확인하기

브라우저에서 `localhost:80` 접속

### 5️⃣ 실행되고 있는 모든 컨테이너 상태 확인하기

```bash
$ docker ps
```

### **`docker ps` 명령어 상세 분석**

```
출력 예시:
CONTAINER ID   IMAGE   COMMAND                  CREATED         STATUS         PORTS                NAMES
3f4d8e92a45b   nginx   "/docker-entrypoint.…"   2 minutes ago   Up 2 minutes   0.0.0.0:80->80/tcp   webserver

각 컬럼 설명:
- CONTAINER ID: 컨테이너 고유 식별자 (축약형)
- IMAGE: 사용된 이미지
- COMMAND: 컨테이너에서 실행 중인 명령어
- CREATED: 컨테이너 생성 시점
- STATUS: 현재 상태 (Up, Exited, Paused 등)
- PORTS: 포트 매핑 정보
- NAMES: 컨테이너 이름
```

### **다양한 ps 옵션들**

```bash
모든 컨테이너 보기 (중지된 것 포함):
$ docker ps -a

CONTAINER ID   IMAGE   COMMAND   CREATED   STATUS                    PORTS   NAMES
3f4d8e92a45b   nginx   "..."     5 min     Up 5 minutes             80/tcp   webserver
1a2b3c4d5e6f   mysql   "..."     1 hour    Exited (0) 30 min ago            old-mysql

마지막 n개 컨테이너 보기:
$ docker ps -n 3

컨테이너 크기 정보 포함:
$ docker ps -s

SIZE 컬럼 추가:
SIZE
2.13kB (virtual 141MB)
*# 2.13kB: 쓰기 레이어 크기# 141MB: 전체 가상 크기*

ID만 출력:
$ docker ps -q
3f4d8e92a45b

커스텀 포맷:
$ docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
NAMES       STATUS          PORTS
webserver   Up 5 minutes    0.0.0.0:80->80/tcp

JSON 형태로 출력:
$ docker ps --format json
{"Command":"\"/docker-entrypoint.sh nginx -g 'daemon off;'\"","CreatedAt":"2023-11-15 19:25:30 +0900 KST","ID":"3f4d8e92a45b","Image":"nginx","Labels":"","LocalVolumes":"0","Mounts":"","Names":"webserver","Networks":"bridge","Ports":"0.0.0.0:80->80/tcp","RunningFor":"5 minutes ago","Size":"0B","State":"running","Status":"Up 5 minutes"}
```

### **컨테이너 상태 상세 정보**

```bash
특정 컨테이너 상세 정보:
$ docker inspect webserver

리소스 사용량 실시간 모니터링:
$ docker stats webserver

CONTAINER ID   NAME        CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS
3f4d8e92a45b   webserver   0.00%     3.352MiB / 7.765GiB   0.04%     656B / 656B   0B / 0B     2

로그 확인:
$ docker logs webserver
$ docker logs -f webserver  *# 실시간 로그 추적*
```

### 6️⃣ 특정 컨테이너 정지

```bash
$ docker stop webserver
```

### **`docker stop` 명령어 상세 분석**

```bash
docker stop [OPTIONS] CONTAINER [CONTAINER...]

정지 과정:
1. SIGTERM 신호 전송 (정상 종료 요청)
2. Grace period 대기 (기본 10초)
3. 응답 없으면 SIGKILL 신호 전송 (강제 종료)

옵션들:
-t, --time: Grace period 설정 (초)
$ docker stop -t 30 webserver  *# 30초 대기*

여러 컨테이너 동시 정지:
$ docker stop webserver database cache

모든 실행 중인 컨테이너 정지:
$ docker stop $(docker ps -q)
```

### **정지 vs 삭제 vs 일시정지**

```bash
다양한 컨테이너 제어 명령어:

정지 (데이터 보존):
$ docker stop webserver
*# 컨테이너는 존재하지만 실행 중지# docker ps -a에서 "Exited" 상태로 표시*

재시작:
$ docker start webserver   *# 정지된 컨테이너 재시작*
$ docker restart webserver *# 실행 중인 컨테이너 재시작*

일시정지:
$ docker pause webserver   *# 프로세스 일시정지 (SIGSTOP)*
$ docker unpause webserver *# 일시정지 해제 (SIGCONT)*

삭제 (데이터 완전 삭제):
$ docker rm webserver      *# 정지된 컨테이너 삭제*
$ docker rm -f webserver   *# 실행 중인 컨테이너 강제 삭제*

정지 + 삭제 한번에:
$ docker rm -f webserver

이미지 삭제:
$ docker rmi nginx         *# nginx 이미지 삭제*
```

### 🔄 전체 실습 흐름 정리

```
`완전한 실습 흐름:

1. Docker 실행 확인
$ docker version

2. 이미지 다운로드
$ docker pull nginx
$ docker image ls

3. 컨테이너 실행
$ docker run --name webserver -d -p 80:80 nginx
$ docker ps

4. 동작 확인
$ curl localhost:80
*# 또는 브라우저에서 localhost:80 접속*

5. 정리
$ docker stop webserver
$ docker rm webserver
$ docker rmi nginx`
```