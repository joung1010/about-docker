## 이미지 조회/삭제

### 📋 다운받은 모든 이미지 조회

```bash
$ docker image ls
```

### **명령어 출력 분석**

```bash
출력 예시:
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
nginx         latest    605c77e624dd   2 weeks ago    141MB
nginx         alpine    4f380adfc10f   2 weeks ago    38MB
mysql         8.0       3218b38490ce   3 weeks ago    516MB
python        3.9       a5d7930b60cc   1 month ago    918MB

각 컬럼 상세 설명:
```

- **`REPOSITORY`** : 이미지 이름(이미지명)
- **`TAG`** : 이미지 태그명
- **`IMAGE ID`** : 이미지 고유 식별자 (SHA256 해시의 축약형)
- **`CREATED`** : 이미지가 생성된 날짜 (**다운받은 날짜가 아님!**)
- **`SIZE`** : 이미지 크기 (압축된 상태)

### **중요한 개념들**

CREATED 날짜의 의미:

- 이미지가 Docker Hub에서 빌드된 날짜
- 내가 다운받은 날짜가 아님
- 이미지 제작자가 docker build 실행한 날짜

IMAGE ID의 특징:

- SHA256 해시값의 앞 12자리
- 전체 ID: sha256:605c77e624dd2037d35d...
- 표시되는 ID: 605c77e624dd
- 이미지 내용이 바뀌면 ID도 변경됨 SIZE의 의미:
- 압축된 이미지 크기
- 실제 다운로드한 용량
- 컨테이너 실행 시 더 많은 공간 사용

### **다양한 조회 옵션들**

```bash
기본 명령어들:
$ docker image ls          *# 새로운 형태 (권장)*
$ docker images            *# 기존 형태 (호환성)*
$ docker image list        *# 완전한 형태*

특정 이미지만 조회:
$ docker image ls nginx
$ docker image ls nginx:alpine
$ docker image ls nginx:*  *# nginx의 모든 태그*

필터링 옵션:
$ docker image ls --filter "dangling=true"    *# 태그 없는 이미지*
$ docker image ls --filter "before=nginx"     *# nginx보다 이전 이미지*
$ docker image ls --filter "since=mysql"      *# mysql 이후 이미지*
$ docker image ls --filter "reference=*/nginx"# 이름에 nginx 포함

크기별 정렬:
$ docker image ls --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | sort -k3 -h

ID만 출력:
$ docker image ls -q
605c77e624dd
4f380adfc10f
3218b38490ce

전체 IMAGE ID 표시:
$ docker image ls --no-trunc
REPOSITORY   TAG     IMAGE ID                                                         CREATED     SIZE
nginx        latest  sha256:605c77e624dd2037d35d9f0d7661ffd8d2a9b8e8c7b3f1a4d8e7c2f6b9   2 weeks ago 141MB
```

### 🗑️ 이미지 삭제

### **[특정 이미지 삭제]**

```bash
$ docker image rm [이미지 ID 또는 이미지명]
```

**`rm`** : remove의 약자

### **이미지 ID 부분 입력**

**이미지 ID**를 입력할 때 전체 ID를 다 입력하지 않고 **ID의 일부만 입력해도 돼요**.

```bash
전체 IMAGE ID: 605c77e624dd2037d35d9f0d7661ffd8d2a9b8e8c7b3f1a4d8e7c2f6b9

사용 가능한 부분 ID들:
$ docker image rm 605c77e624dd    *# 기본 표시된 12자리*
$ docker image rm 605c77e6        *# 앞 8자리*
$ docker image rm 605c77          *# 앞 6자리*
$ docker image rm 605c            *# 앞 4자리*

조건: 입력한 ID의 일부를 가진 이미지가 단 1개여야 함

예시 상황:
IMAGE ID
605c77e624dd  ← nginx:latest
605c88f123ab  ← mysql:8.0

$ docker image rm 605c    *# ❌ 에러! 두 이미지 모두 605c로 시작*
$ docker image rm 605c77  *# ✅ 성공! nginx만 해당*
$ docker image rm 605c88  *# ✅ 성공! mysql만 해당*
```

### **이미지명과 태그로 삭제**

```bash
이미지명으로 삭제:
$ docker image rm nginx           *# nginx:latest 삭제*
$ docker image rm nginx:alpine    *# nginx:alpine 삭제*
$ docker image rm nginx:1.21      *# nginx:1.21 삭제*

여러 이미지 동시 삭제:
$ docker image rm nginx mysql python
$ docker image rm nginx:alpine nginx:stable mysql:8.0
```

### ⚠️ 컨테이너 사용 중인 이미지 삭제

**컨테이너에서 사용하고 있지 않은 이미지만 삭제가 가능해요**

### **컨테이너를 생성한 이미지 삭제 시 에러**

```bash
$ docker image rm nginx
Error response from daemon: conflict: unable to delete a776e89aad2d (must be forced) - image is being used by stopped container 40fddd7b6f85
```

### **에러 상황 분석**

```bash
이미지 사용 상태 확인:
$ docker ps -a
CONTAINER ID   IMAGE   COMMAND   CREATED   STATUS                    PORTS   NAMES
40fddd7b6f85   nginx   "..."     1 hour    Exited (0) 5 minutes ago          webserver

상황 설명:
- nginx 이미지로 webserver 컨테이너 생성됨
- 컨테이너는 현재 중지된 상태 (Exited)
- 하지만 여전히 컨테이너가 존재하므로 이미지 삭제 불가
- Docker는 이미지와 컨테이너 간의 의존성 보호
```

### **해결 방법들**

```bash
방법 1: 컨테이너 먼저 삭제
$ docker rm webserver     *# 컨테이너 삭제*
$ docker image rm nginx   *# 이미지 삭제*

방법 2: 한 번에 처리
$ docker rm webserver && docker image rm nginx

방법 3: 강제 삭제 (주의!)
$ docker image rm -f nginx
```

### 💪 강제 삭제

### **[중지된 컨테이너에서 사용하고 있는 이미지 강제 삭제하기]**

```bash
$ docker image rm -f [이미지 ID 또는 이미지명]
```

### **강제 삭제의 동작**

```bash
강제 삭제 과정:
1. 이미지 사용 중인 중지된 컨테이너들을 자동으로 삭제
2. 이미지 삭제 실행
3. 관련된 레이어들 정리

주의사항:
✅ 중지된(Exited) 컨테이너: 강제 삭제 가능
❌ 실행 중인(Running) 컨테이너: 강제 삭제 불가능

실행 중인 컨테이너가 있는 경우:
$ docker image rm -f nginx
Error: image is being used by running container abc123def456
```

### **실행 중인 컨테이너 처리**

```bash
실행 중인 컨테이너 확인:
$ docker ps
CONTAINER ID   IMAGE   COMMAND   CREATED   STATUS         PORTS                NAMES
abc123def456   nginx   "..."     1 hour    Up 10 minutes  0.0.0.0:80->80/tcp   webserver

해결 방법:
1. 컨테이너 중지 후 삭제:
$ docker stop webserver
$ docker rm webserver
$ docker image rm nginx

2. 강제로 컨테이너 삭제:
$ docker rm -f webserver  *# 실행 중인 컨테이너 강제 종료 및 삭제*
$ docker image rm nginx
```

### 🧹 전체 이미지 삭제

### **[전체 이미지 삭제]**

```bash
*# 컨테이너에서 사용하고 있지 않은 이미지만 전체 삭제*
$ docker image rm $(docker images -q)

*# 컨테이너에서 사용하고 있는 이미지를 포함해서 전체 이미지 삭제*
$ docker image rm -f $(docker images -q)
```

### **명령어 분석**

**`docker images -q`** : 시스템에 있는 모든 이미지의 ID를 반환해요. 여기서 **`-q`** 옵션은 **quiet**을 의미하며, 상세 정보 대신에 각 이미지의 고유한 ID만 표시하도록 지시해요.

```bash
docker images -q 실행 결과:
605c77e624dd
4f380adfc10f
3218b38490ce
a5d7930b60cc

$(docker images -q) 동작 원리:
1. docker images -q 실행
2. 모든 이미지 ID 목록 반환
3. $() 구문으로 결과를 다른 명령어에 전달
4. docker image rm에 모든 ID가 인수로 전달

실제 실행되는 명령어:
$ docker image rm 605c77e624dd 4f380adfc10f 3218b38490ce a5d7930b60cc
```

### **안전한 전체 삭제 방법**

```bash
1단계: 사용하지 않는 이미지만 삭제
$ docker image prune
WARNING! This will remove all dangling images.
Are you sure you want to continue? [y/N] y

2단계: 사용하지 않는 모든 이미지 삭제
$ docker image prune -a
WARNING! This will remove all images without at least one container associated to them.
Are you sure you want to continue? [y/N] y

3단계: 필터를 사용한 선택적 삭제
$ docker image prune --filter "until=24h"  *# 24시간 이전 이미지만*
$ docker image prune --filter "label!=keep"  *# keep 라벨이 없는 이미지만*
```

### 🔍 이미지 의존성 관리

### **이미지 레이어 공유**

```bash
레이어 공유 확인:
$ docker image ls
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
nginx        latest    605c77e624dd   2 weeks ago   141MB
nginx        alpine    4f380adfc10f   2 weeks ago   38MB

$ docker system df  *# 디스크 사용량 확인*
TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
Images          2         1         179MB     38MB (21%)
Containers      1         0         0B        0B
Local Volumes   0         0         0B        0B
Build Cache     0         0         0B        0B

실제 디스크 사용량:
- nginx:latest + nginx:alpine = 179MB (141MB + 38MB = 179MB)
- 일부 레이어 공유로 실제 용량은 더 적음
```

### **이미지 삭제 시 주의사항**

```bash
공유 레이어가 있는 경우:
$ docker image rm nginx:alpine
Untagged: nginx:alpine
Deleted: sha256:4f380adfc10f...  *# alpine만의 레이어# 공유 레이어는 삭제되지 않음 (nginx:latest가 사용 중)*

모든 nginx 이미지 삭제:
$ docker image rm nginx:latest nginx:alpine
Untagged: nginx:latest
Untagged: nginx:alpine  
Deleted: sha256:605c77e624dd...  *# 모든 레이어 삭제*
Deleted: sha256:4f380adfc10f...
```

### 🛠️ 유용한 이미지 관리 명령어들

### **이미지 정보 확인**

```bash
이미지 상세 정보:
$ docker image inspect nginx
$ docker image inspect nginx --format='{{.RepoTags}}'

이미지 히스토리:
$ docker image history nginx
IMAGE          CREATED        CREATED BY                                      SIZE
605c77e624dd   2 weeks ago    /bin/sh -c *#(nop)  CMD ["nginx" "-g" "daemon…   0B*
<missing>      2 weeks ago    /bin/sh -c *#(nop)  STOPSIGNAL SIGQUIT           0B*

이미지 레이어 분석:
$ docker image save nginx > nginx.tar  *# 이미지 파일로 저장*
$ tar -tf nginx.tar | head -20         *# 아카이브 내용 확인*`
```

### **시스템 정리**

```bash
전체 시스템 정리:
$ docker system prune
WARNING! This will remove:
  - all stopped containers
  - all networks not used by at least one container
  - all dangling images
  - all dangling build cache

전체 시스템 완전 정리:
$ docker system prune -a --volumes
*# 사용하지 않는 모든 것 삭제 (이미지, 컨테이너, 볼륨, 네트워크)*

정리 전 용량 확인:
$ docker system df -v  *# 상세한 용량 정보*
```