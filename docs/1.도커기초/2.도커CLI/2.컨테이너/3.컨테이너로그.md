## 컨테이너 로그 조회

### 📋 컨테이너(Container) 로그 조회

### **[특정 컨테이너의 모든 로그 조회]**

```bash
*# docker logs [컨테이너 ID 또는 컨테이너명]*

$ docker run -d nginx
$ docker logs [nginx가 실행되고 있는 컨테이너 ID]
```

### **Docker 로그 시스템 이해**

```bash
Docker 로그 구조:
┌─────────────────────────────────────────────────┐
│              Container                          │
│  ┌─────────────────────────────────────────────┐│
│  │ Application (nginx)                         ││
│  │ ├─ stdout (표준 출력)                       ││
│  │ │  └─ 액세스 로그, 일반 메시지               ││
│  │ └─ stderr (표준 에러)                       ││
│  │    └─ 에러 메시지, 경고                     ││
│  └─────────────────────────────────────────────┘│
└─────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────┐
│            Docker Log Driver                    │
│  ┌─────────────────────────────────────────────┐│
│  │ 기본: json-file                             ││
│  │ 위치: /var/lib/docker/containers/           ││
│  │      [container-id]/[container-id]-json.log ││
│  │                                            ││
│  │ 다른 드라이버:                              ││
│  │ - syslog: 시스템 로그로 전송                ││
│  │ - journald: systemd 저널로 전송             ││
│  │ - gelf: Graylog로 전송                     ││
│  │ - awslogs: AWS CloudWatch로 전송           ││
│  └─────────────────────────────────────────────┘│
└─────────────────────────────────────────────────┘
```

### **로그 조회 실습**

```bash
nginx 컨테이너 실행 및 로그 확인:
$ docker run -d --name web nginx
abc123def456

모든 로그 조회:
$ docker logs web
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
20-envsubst-on-templates.sh: info: No template files found, skipping
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
30-tune-worker-processes.sh: info: no config file specified, using defaults
/docker-entrypoint.sh: Configuration complete; ready for start up
2023/11/15 10:30:45 [notice] 1*#1: using the "epoll" event method*
2023/11/15 10:30:45 [notice] 1*#1: nginx/1.25.3*
2023/11/15 10:30:45 [notice] 1*#1: start worker processes*
2023/11/15 10:30:45 [notice] 1*#1: start worker process 29*

로그 구성 요소:
- 시작 스크립트 실행 로그
- nginx 설정 초기화 로그  
- nginx 마스터 프로세스 시작 로그
- 워커 프로세스 시작 로그
```

### 📝 최근 로그 10줄만 조회

### **[최근 로그 10줄만 조회]**

```bash
*# docker logs --tail [로그 끝부터 표시할 줄 수] [컨테이너 ID 또는 컨테이너명]*
$ docker logs --tail 10 [컨테이너 ID 또는 컨테이너명]
```

### **-tail 옵션 상세**

```bash
다양한 tail 사용법:
$ docker logs --tail 10 web      *# 마지막 10줄*
$ docker logs --tail 5 web       *# 마지막 5줄*
$ docker logs --tail 1 web       *# 마지막 1줄*
$ docker logs --tail 100 web     *# 마지막 100줄*

실제 출력 예시:
$ docker logs --tail 5 web
/docker-entrypoint.sh: Configuration complete; ready for start up
2023/11/15 10:30:45 [notice] 1*#1: using the "epoll" event method*
2023/11/15 10:30:45 [notice] 1*#1: nginx/1.25.3*
2023/11/15 10:30:45 [notice] 1*#1: start worker processes*
2023/11/15 10:30:45 [notice] 1*#1: start worker process 29*

파일 크기가 큰 로그에서 유용:
- 대용량 로그에서 최신 정보만 빠르게 확인
- 네트워크 대역폭 절약
- 터미널 출력 양 제한
```

### 📺 기존 로그 조회 + 생성되는 로그를 실시간으로 보고 싶은 경우

### **[기존 로그 조회 + 실시간 로그 추적]**

```bash
*# docker logs -f [컨테이너 ID 또는 컨테이너명]# Nginx의 컨테이너에 실시간으로 쌓이는 로그 확인하기*
$ docker run -d -p 80:80 nginx
$ docker logs -f [컨테이너 ID 또는 컨테이너명]
```

- **`f`** : **follow**의 약어

### **f 옵션 상세 동작**

```bash
실시간 로그 추적:
$ docker logs -f web
/docker-entrypoint.sh: Configuration complete; ready for start up
2023/11/15 10:30:45 [notice] 1*#1: using the "epoll" event method*
2023/11/15 10:30:45 [notice] 1*#1: nginx/1.25.3*
2023/11/15 10:30:45 [notice] 1*#1: start worker processes*
2023/11/15 10:30:45 [notice] 1*#1: start worker process 29# 여기서 대기 상태 (새 로그 기다림)*

새로운 터미널에서 웹사이트 접속:
$ curl localhost
<!DOCTYPE html>...

첫 번째 터미널에 실시간으로 추가됨:
172.17.0.1 - - [15/Nov/2023:10:35:22 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"

동작 원리:
1. 기존 모든 로그 출력
2. 로그 파일 감시 시작 (inotify)
3. 새 로그 발생 시 즉시 출력
4. Ctrl+C로 추적 중단
```

### **실시간 로그 활용 시나리오**

```bash
웹서버 트래픽 모니터링:
$ docker run -d -p 80:80 --name web nginx
$ docker logs -f web &           *# 백그라운드에서 로그 추적# 다른 터미널에서 부하 테스트*
$ for i in {1..10}; do curl localhost; done

로그 출력:
172.17.0.1 - - [15/Nov/2023:10:40:15 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"
172.17.0.1 - - [15/Nov/2023:10:40:15 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"
172.17.0.1 - - [15/Nov/2023:10:40:15 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"
...

애플리케이션 디버깅:
$ docker logs -f app-container
INFO: Starting application...
DEBUG: Loading configuration from /app/config.json
WARN: Database connection timeout, retrying...
ERROR: Failed to connect to database: connection refused
```

### 🔄 기존 로그는 조회하지 않기 + 생성되는 로그를 실시간으로 보고 싶은 경우

### **[기존 로그 제외하고 실시간 로그만 추적]**

```bash
$ docker logs --tail 0 -f [컨테이너 ID 또는 컨테이너명]
```

### **-tail 0 -f 조합 활용**

```bash
기존 로그 무시하고 새 로그만 추적:
$ docker logs --tail 0 -f web
*# 기존 로그는 출력하지 않음# 새로 발생하는 로그만 실시간 표시*

활용 상황:
1. 장시간 실행된 컨테이너 (기존 로그가 너무 많음)
2. 특정 시점부터의 로그만 관심 있는 경우
3. 실시간 모니터링에만 집중하고 싶은 경우

실습:
$ docker run -d -p 80:80 --name web nginx
$ docker logs --tail 0 -f web
*# 아무것도 출력되지 않음 (대기 상태)*

$ curl localhost
*# 즉시 새 로그 출력:*
172.17.0.1 - - [15/Nov/2023:10:45:30 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"
```