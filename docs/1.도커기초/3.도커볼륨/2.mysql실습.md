## Docker로 MySQL 실행시켜보기

### 1. MySQL 이미지를 바탕으로 컨테이너 실행시키기

```bash
$ docker run -e MYSQL_ROOT_PASSWORD=password123 -p 3306:3306 -d mysql
```

### **명령어 상세 분석**

```
docker run 옵션 분석:
-e MYSQL_ROOT_PASSWORD=password123: 환경 변수 설정
-p 3306:3306: 포트 매핑 (호스트:컨테이너)
-d: 백그라운드 실행
mysql: 이미지명 (mysql:latest와 동일)
```

**참고)** `docker pull` 과정은 생략해도 상관없어요. 왜냐하면 `docker run mysql`로 실행시켰을 때, 로컬에 이미지가 없으면 Docker Hub으로부터 MySQL 이미지를 알아서 다운받아서 실행시키기 때문이에요.

### **환경 변수 설정**

- **`e MYSQL_ROOT_PASSWORD=password123`** : `e` 옵션은 컨테이너의 환경 변수를 설정하는 옵션이에요.

Docker Hub의 MySQL 공식 문서를 보면 환경 변수로 `MYSQL_ROOT_PASSWORD`를 정해주어야만 정상적으로 컨테이너가 실행된다고 적혀있어요.

```bash
MySQL 환경 변수들:
MYSQL_ROOT_PASSWORD: root 사용자 비밀번호 (필수)
MYSQL_DATABASE: 초기 생성할 데이터베이스명
MYSQL_USER: 추가 사용자명
MYSQL_PASSWORD: 추가 사용자 비밀번호
MYSQL_ALLOW_EMPTY_PASSWORD: 빈 비밀번호 허용 (보안상 비권장)
MYSQL_RANDOM_ROOT_PASSWORD: 랜덤 root 비밀번호 생성

복합 설정 예시:
$ docker run -d \
  -e MYSQL_ROOT_PASSWORD=rootpass123 \
  -e MYSQL_DATABASE=myapp \
  -e MYSQL_USER=appuser \
  -e MYSQL_PASSWORD=userpass123 \
  -p 3306:3306 \
  --name mysql-server \
  mysql:8.0
```

### **환경 변수 확인하기**

아래의 명령어로 컨테이너로 들어가서 환경 변수를 직접 눈으로 확인해보죠.

```bash
$ docker exec -it [MySQL 컨테이너 ID] bash

$ echo $MYSQL_ROOT_PASSWORD *# MYSQL_ROOT_PASSWORD라는 환경변수 값 출력*
$ export *# 설정되어 있는 모든 환경변수 출력*
```

### **실제 환경 변수 확인 과정**

```bash
컨테이너 실행:
$ docker run -e MYSQL_ROOT_PASSWORD=password123 -p 3306:3306 -d --name mysql-test mysql
abc123def456

컨테이너 접속:
$ docker exec -it mysql-test bash
root@abc123def456:/*#* 

환경 변수 확인:
root@abc123def456:/*# echo $MYSQL_ROOT_PASSWORD*
password123

root@abc123def456:/*# env | grep MYSQL*
MYSQL_ROOT_PASSWORD=password123
MYSQL_MAJOR=8.0
MYSQL_VERSION=8.0.35-1debian12

모든 환경 변수 출력:
root@abc123def456:/*# export*
declare -x HOME="/root"
declare -x HOSTNAME="abc123def456"
declare -x MYSQL_ROOT_PASSWORD="password123"
declare -x PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
declare -x PWD="/"
declare -x TERM="xterm"
```

### 2. 컨테이너가 잘 실행되고 있는지 체크

```bash
$ docker ps
```

### **MySQL 컨테이너 상태 확인**

```bash
출력 예시:
CONTAINER ID   IMAGE   COMMAND                  CREATED         STATUS         PORTS                    NAMES
abc123def456   mysql   "docker-entrypoint.s…"   2 minutes ago   Up 2 minutes   0.0.0.0:3306->3306/tcp   mysql-test

상태 확인 포인트:
- STATUS: "Up 2 minutes" (정상 실행 중)
- PORTS: "0.0.0.0:3306->3306/tcp" (포트 매핑 정상)
- COMMAND: "docker-entrypoint.s..." (MySQL 시작 스크립트 실행)

추가 상태 확인:
$ docker stats mysql-test
CONTAINER ID   NAME        CPU %     MEM USAGE / LIMIT     MEM %     NET I/O       BLOCK I/O   PIDS
abc123def456   mysql-test  0.15%     373.2MiB / 7.765GiB   4.70%     656B / 0B     0B / 0B     37
```

### 3. 컨테이너 실행시킬 때 에러 없이 잘 실행됐는지 로그 체크

```bash
$ docker logs [컨테이너 ID 또는 컨테이너명]
```

### **MySQL 초기화 로그 분석**

```bash
MySQL 정상 시작 로그:
$ docker logs mysql-test

2023-11-15 10:30:45+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.35-1debian12 started.
2023-11-15 10:30:45+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
2023-11-15 10:30:45+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.35-1debian12 started.
2023-11-15 10:30:45+00:00 [Note] [Entrypoint]: Initializing database files
...
2023-11-15T10:30:50.123456Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.35) initializing of server in progress as process 80
2023-11-15T10:30:52.456789Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2023-11-15T10:30:55.789012Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
...
2023-11-15T10:30:58.123456Z 0 [Warning] [MY-000081] [Server] option 'default_authentication_plugin' is deprecated and will be removed in a future release. Please use authentication_policy instead.
2023-11-15T10:30:58.234567Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: '8.0.35'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306

핵심 메시지:
"ready for connections" - MySQL 서버가 연결 대기 상태
"port: 3306" - 3306 포트에서 서비스 중
```

### **일반적인 에러와 해결 방법**

```bash
환경 변수 누락 에러:
error: database is uninitialized and password option is not specified
해결: MYSQL_ROOT_PASSWORD 환경 변수 설정 필요

포트 충돌 에러:
Error starting userland proxy: listen tcp4 0.0.0.0:3306: bind: address already in use
해결: 다른 포트 사용 (-p 3307:3306)

메모리 부족 에러:
mysqld: [ERROR] Fatal error: Out of memory
해결: 메모리 제한 늘리기 (docker run -m 2g)

데이터 디렉토리 권한 에러:
[ERROR] --initialize specified but the data directory has files in it
해결: 볼륨 디렉토리 정리 또는 새 볼륨 사용
```

### 4.GUIL 툴로 연결시켜보기

### **DBeaver 연결 설정**

```
DBeaver 연결 정보:
- Server Host: localhost (또는 127.0.0.1)
- Port: 3306
- Database: (비워두거나 mysql)
- Username: root
- Password: password123

연결 테스트:
1. DBeaver 실행
2. 새 연결 생성 (Database > New Database Connection)
3. MySQL 선택
4. 연결 정보 입력
5. "Test Connection" 클릭
6. "Connected" 메시지 확인
```

### **명령줄 클라이언트 연결**

```bash
호스트에서 MySQL 클라이언트로 연결:
$ mysql -h localhost -P 3306 -u root -p
Enter password: password123

mysql> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+

컨테이너 내부에서 연결:
$ docker exec -it mysql-test mysql -u root -p
Enter password: password123

mysql> SELECT VERSION();
+-----------+
| VERSION() |
+-----------+
| 8.0.35    |
+-----------+
```