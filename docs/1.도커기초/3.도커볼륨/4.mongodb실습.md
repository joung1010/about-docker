## Docker로 MongoDB 실행시켜보기

### 1. MongoDB 이미지를 바탕으로 컨테이너 실행시키기

```bash
$ cd /Users/jaeseong/Documents/Develop
$ mkdir docker-mongodb

$ docker run -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=password123 -p 27017:27017 -v /Users/jaeseong/Documents/Develop/docker-mongodb/mongodb_data:/data/db -d mongo
```

### **명령어 상세 분석**

```bash
docker run 옵션 분석:
-e MONGO_INITDB_ROOT_USERNAME=root: 관리자 사용자명 설정
-e MONGO_INITDB_ROOT_PASSWORD=password123: 관리자 비밀번호 설정
-p 27017:27017: 포트 매핑 (MongoDB 기본 포트)
-v [호스트경로]:/data/db: MongoDB 데이터 디렉토리 볼륨 마운트
-d: 백그라운드 실행
mongo: MongoDB 공식 이미지 (mongo:latest)
```

### **MongoDB 환경 변수**

```bash
MongoDB 주요 환경 변수:
MONGO_INITDB_ROOT_USERNAME: 루트 사용자명 (필수, 인증 활성화 시)
MONGO_INITDB_ROOT_PASSWORD: 루트 비밀번호 (필수, 인증 활성화 시)
MONGO_INITDB_DATABASE: 초기 생성할 데이터베이스명
MONGO_INITDB_USERNAME: 초기 데이터베이스 사용자명
MONGO_INITDB_PASSWORD: 초기 데이터베이스 비밀번호

vs 다른 데이터베이스:
MySQL: MYSQL_ROOT_PASSWORD
PostgreSQL: POSTGRES_PASSWORD
MongoDB: MONGO_INITDB_ROOT_PASSWORD

복합 설정 예시:
$ docker run -d \
  --name mongodb-server \
  -e MONGO_INITDB_ROOT_USERNAME=admin \
  -e MONGO_INITDB_ROOT_PASSWORD=secure123 \
  -e MONGO_INITDB_DATABASE=myapp \
  -p 27017:27017 \
  -v ~/docker-mongodb/mongodb_data:/data/db \
  mongo:6.0
```

### 2. 컨테이너가 잘

```bash

$ docker ps
```

### **MongoDB 컨테이너 상태 확인**

```bash
출력 예시:
CONTAINER ID   IMAGE   COMMAND                  CREATED         STATUS         PORTS                      NAMES
abc123def456   mongo   "docker-entrypoint.s…"   2 minutes ago   Up 2 minutes   0.0.0.0:27017->27017/tcp   amazing_mongo

상태 확인 포인트:
- STATUS: "Up 2 minutes" (정상 실행 중)
- PORTS: "0.0.0.0:27017->27017/tcp" (포트 매핑 정상)
- COMMAND: "docker-entrypoint.s..." (MongoDB 시작 스크립트)

MongoDB 프로세스 확인:
$ docker exec abc123def456 ps aux
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
mongodb        1  1.2  2.3  1694288 187456 ?     Ssl  10:30   0:02 mongod --auth --bind_ip_all
```

### 3. 컨테이너 실행시킬 때 에러 없이 잘 실행됐는지 로그 체크

```bash
$ docker logs [컨테이너 ID 또는 컨테이너명]
```

### **MongoDB 초기화 로그 분석**

```bash
MongoDB 정상 시작 로그:
$ docker logs abc123def456

about to fork child process, waiting until server is ready for connections.
forked process: 29
child process started successfully, parent exiting

{"t":{"$date":"2023-11-15T10:30:45.123+00:00"},"s":"I","c":"CONTROL","id":23285,"ctx":"main","msg":"Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols 'none'"}
{"t":{"$date":"2023-11-15T10:30:45.124+00:00"},"s":"I","c":"NETWORK","id":4915701,"ctx":"main","msg":"Initialized wire specification","attr":{"spec":{"incomingExternalClient":{"minWireVersion":0,"maxWireVersion":17},"incomingInternalClient":{"minWireVersion":0,"maxWireVersion":17},"outgoing":{"minWireVersion":0,"maxWireVersion":17},"isInternalClient":true}}}
{"t":{"$date":"2023-11-15T10:30:45.125+00:00"},"s":"I","c":"NETWORK","id":23016,"ctx":"listener","msg":"Waiting for connections","attr":{"port":27017,"ssl":"off"}}

핵심 메시지:
"Waiting for connections" - 연결 대기 상태
"port":27017 - 27017 포트에서 서비스 중
"child process started successfully" - MongoDB 프로세스 정상 시작
```

### 4. MongoDB 컨테이너에 접속

```bash
$ docker exec -it [컨테이너 ID 또는 컨테이너명] bash
```

### **컨테이너 접속 과정**

```bash
MongoDB 컨테이너 접속:
$ docker exec -it abc123def456 bash
root@abc123def456:/*#* 

프롬프트 분석:
- root: MongoDB 컨테이너에서는 root로 접속 (PostgreSQL과 다름)
- @abc123def456: 컨테이너 호스트명
- :/: 현재 위치 (루트 디렉토리)
- *#: root 사용자 프롬프트*

MongoDB 관련 파일 확인:
root@abc123def456:/*# which mongod*
/usr/bin/mongod

root@abc123def456:/*# which mongosh*
/usr/bin/mongosh

root@abc123def456:/*# ls -la /data/db/*
total 12
drwxr-xr-x 1 mongodb mongodb  4096 Nov 15 10:30 .
drwxr-xr-x 1 root    root     4096 Nov 15 10:30 ..
-rw------- 1 mongodb mongodb    20 Nov 15 10:30 WiredTiger
-rw------- 1 mongodb mongodb    21 Nov 15 10:30 WiredTiger.lock
...
```

### 5. 컨테이너에서 MongoDB에 접근하기

```bash
$ mongosh
```

### **mongosh 클라이언트 사용**

```bash
mongosh 접속 (인증 없는 경우):
root@abc123def456:/*# mongosh*
Current Mongosh Log ID: 655623abc123def456
Connecting to: mongodb://127.0.0.1:27017/?directConnection=true&serverSelectionTimeoutMS=2000&appName=mongosh+2.0.2
Using MongoDB: 7.0.4
Using Mongosh: 2.0.2

test> 

mongosh 접속 (인증 있는 경우):
root@abc123def456:/*# mongosh -u root -p password123*
Current Mongosh Log ID: 655623abc123def456
Connecting to: mongodb://<credentials>@127.0.0.1:27017/?directConnection=true&serverSelectionTimeoutMS=2000&appName=mongosh+2.0.2
Using MongoDB: 7.0.4
Using Mongosh: 2.0.2

test> 

프롬프트 의미:
- test: 현재 선택된 데이터베이스 (기본값)
- >: mongosh 프롬프트
```

### **MongoDB 특화 기능**

```bash
인덱스 생성:
myapp> db.users.createIndex({email: 1})
{
  numIndexesBefore: 1,
  numIndexesAfter: 2,
  createdCollectionAutomatically: false,
  ok: 1
}

인덱스 확인:
myapp> db.users.getIndexes()
[
  { v: 2, key: { _id: 1 }, name: '_id_' },
  { v: 2, key: { email: 1 }, name: 'email_1' }
]

집계 파이프라인:
myapp> db.users.aggregate([
  {$match: {age: {$gte: 25}}},
  {$group: {_id: "$city", count: {$sum: 1}, avgAge: {$avg: "$age"}}},
  {$sort: {count: -1}}
])
[
  { _id: 'Seoul', count: 2, avgAge: 31 },
  { _id: 'Busan', count: 1, avgAge: 28 },
  { _id: null, count: 1, avgAge: 25 }
]

데이터 업데이트:
myapp> db.users.updateOne(
  {name: "Alice"},
  {$set: {city: "Incheon"}, $push: {skills: "Docker"}}
)

데이터 삭제:
myapp> db.users.deleteOne({name: "Bob"})
```

### 7. MongoDB 데이터가 볼륨에 잘 저장되고 있는지 확인해보기

```bash
$ cd /Users/jaeseong/Documents/Develop/docker-mongodb/mongodb_data
$ ls
```