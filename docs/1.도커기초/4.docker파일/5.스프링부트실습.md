## 백엔드 프로젝트(Spring Boot) 프로젝트를 Docker로 실행시키기

### 1. 프로젝트 셋팅

- Java 21 버전을 선택하자. 아래 과정을 Java 21 버전을 기준으로 진행할 예정이다.

### 2. 간단한 코드 작성

**AppController**

```java
@RestController
public class AppController {
  @GetMapping("/")
  public String home() {
    return "Hello, World!";
  }
}
```

### 2.build.gradle

```docker
bootJar {
    archiveFileName = 'app.jar'
}
```

### 3. Dockerfile 작성하기

**Dockerfile**

```docker
FROM openjdk:21-jdk

COPY build/libs/*SNAPSHOT.jar app.jar

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

**주의사항**: Java 21을 사용한다면 베이스 이미지도 `openjdk:21-jdk`로 맞춰야 합니다.

### 4. Spring Boot 프로젝트 빌드하기

```bash
$ ./gradlew clean build
```

### **빌드 후 확인**

```bash
$ ls -la build/libs/
*# app.jar 또는 프로젝트명-SNAPSHOT.jar 파일 확인*
```

### 5. 빌드 컨텍스트 문제 해결

앞서 경험한 문제: **Docker 빌드 컨텍스트 파일 경로 오류**

```
ERROR: "/build/libs/app.jar": not found

문제 원인:
- Dockerfile이 프로젝트 루트가 아닌 하위 디렉토리에 위치
- Docker는 빌드 컨텍스트 외부 파일에 접근할 수 없음

해결 방법:
1. Dockerfile을 프로젝트 루트 디렉토리로 이동
2. 또는 프로젝트 루트에서 docker build 실행

올바른 디렉토리 구조:
my-spring-project/
├── src/
├── build/
│   └── libs/
│       └── app.jar
├── Dockerfile          ← 여기에 위치해야 함
└── build.gradle
```

### 6. Dockerfile을 바탕으로 이미지 빌드하기

```bash
$ docker build -t hello-server .
```

### **빌드 실패 시 트러블슈팅**

```bash
*# 캐시 없이 다시 빌드*
$ docker build --no-cache -t hello-server .

*# .dockerignore 확인 (build/ 디렉토리가 제외되어 있는지)*
$ cat .dockerignore

*# 파일 존재 확인*
$ ls build/libs/
```

### 7. 이미지가 잘 생성됐는지 확인하기

```bash
$ docker image ls
REPOSITORY     TAG       IMAGE ID       CREATED          SIZE
hello-server   latest    abc123def456   10 seconds ago   688MB
```

### 8. 생성한 이미지를 컨테이너로 실행시켜보기

```bash
$ docker run -d -p 8080:8080 hello-server
```

### **포트 매핑 설명**

```bash
p 8080:8080 의미:
- 호스트의 8080 포트 → 컨테이너의 8080 포트
- Spring Boot 기본 포트가 8080이므로 매핑 필요
```

### 9. 컨테이너 잘 실행되고 있는지 확인하기

```bash
$ docker ps
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                    NAMES
abc123def456   hello-server   "java -jar /app.jar"     30 seconds ago  Up 30 seconds  0.0.0.0:8080->8080/tcp   amazing_name
```

### **실행 실패 시 디버깅**

```bash
*# 로그 확인*
$ docker logs [컨테이너 ID]

*# 일반적인 Spring Boot 시작 로그가 보여야 함:# Started Application in 2.5 seconds*
```

### 10. [localhost:8080](http://localhost:8080/)으로 들어가보기

브라우저에서 `http://localhost:8080` 접속 시 "Hello, World!" 메시지가 표시되어야 합니다.

### **접속 안 될 시 체크사항**

```bash
*# 컨테이너 상태 재확인*
$ docker ps

*# 포트 매핑 확인*
$ docker port [컨테이너 ID]
8080/tcp -> 0.0.0.0:8080

*# 로그에서 에러 확인*
$ docker logs [컨테이너 ID]
```

### 11. 실행시킨 컨테이너 중지/삭제하기, 이미지 삭제하기

```bash
$ docker stop {컨테이너 ID}
$ docker rm {컨테이너 ID}
$ docker image rm {이미지 ID}
```

### **한 번에 정리하기**

```bash
*# 실행 중인 컨테이너 강제 삭제*
$ docker rm -f [컨테이너 ID]

*# 이미지와 함께 완전 정리*
$ docker system prune
```

### 추가 최적화 팁

### **더 효율적인 Dockerfile**

docker

```docker
FROM openjdk:21-jdk-slim

*# 작업 디렉토리 설정*
WORKDIR /app

*# JAR 파일 복사*
COPY build/libs/*.jar app.jar

*# 포트 노출*
EXPOSE 8080

*# 애플리케이션 실행*
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### **멀티스테이지 빌드 (권장)**

```docker
*# 빌드 스테이지*
FROM openjdk:21-jdk AS build
WORKDIR /src
COPY . .
RUN ./gradlew clean build

*# 실행 스테이지*
FROM openjdk:21-jdk-slim
WORKDIR /app
COPY --from=build /src/build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```