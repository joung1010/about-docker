## EXPOSE : 컨테이너 내부에서 사용 중인 포트를 문서화하기

### 의미

`EXPOSE`는 컨테이너 내부에서 어떤 포트에 프로그램이 실행되는지를 문서화하는 역할만 해요. `docker run -p 8080:8080 …` 와 같은 명령어의 `-p` 옵션과 같은 역할은 일체 하지 않아요. 쉽게 표현하자면 EXPOSE 명령어는 쓰나 안 쓰나 작동하는 방식에는 영향을 미치지 않아요.

### 사용법

```docker
*# 문법*
EXPOSE [포트번호]
EXPOSE [포트번호]/[프로토콜]

*# 예시*
EXPOSE 80
EXPOSE 3000
EXPOSE 443/tcp
EXPOSE 53/udp
```

### EXPOSE의 실제 역할

```bash
EXPOSE의 역할:
1. 문서화 (Documentation)
   - 이 컨테이너가 어떤 포트를 사용하는지 명시
   - 다른 개발자들이 Dockerfile을 보고 이해할 수 있도록

2. 메타데이터 제공
   - docker inspect 명령어로 확인 가능
   - Docker Compose 등에서 참조 가능

3. docker run -P 옵션과 연동
   - -P 옵션 사용 시 EXPOSE된 포트들을 자동으로 매핑

EXPOSE가 하지 않는 것:
❌ 실제 포트 바인딩 (포트 열기)
❌ 방화벽 설정
❌ 네트워크 접근 허용
```

### 실제 동작 비교

### **EXPOSE 없이 실행**

```docker
Dockerfile:
FROM nginx
*# EXPOSE 명령어 없음*

실행:
$ docker build -t test-nginx .
$ docker run -d -p 8080:80 test-nginx
*# 정상 작동함 - EXPOSE가 없어도 포트 매핑 가능*
```

### **EXPOSE와 함께 실행**

```docker
Dockerfile:
FROM nginx
EXPOSE 80

실행:
$ docker build -t test-nginx-exposed .
$ docker run -d -p 8080:80 test-nginx-exposed
*# 똑같이 정상 작동함 - EXPOSE는 문서화 역할만*
```

### EXPOSE의 유용한 기능

### **docker run -P 옵션과 연동**

```docker
Dockerfile:
FROM node:18
WORKDIR /app
COPY . .
EXPOSE 3000
EXPOSE 3001
CMD ["npm", "start"]

자동 포트 매핑:
$ docker run -P my-node-app
*# -P 옵션이 EXPOSE된 포트들을 자동으로 호스트의 랜덤 포트에 매핑*

확인:
$ docker ps
CONTAINER ID   IMAGE        COMMAND       PORTS                     NAMES
abc123def456   my-node-app  "npm start"   0.0.0.0:32768->3000/tcp   amazing_name
                                          0.0.0.0:32769->3001/tcp
```

### **메타데이터 확인**

```docker
이미지 정보 확인:
$ docker inspect my-node-app
"ExposedPorts": {
    "3000/tcp": {},
    "3001/tcp": {}
}

컨테이너 포트 정보:
$ docker port my-container
3000/tcp -> 0.0.0.0:32768
3001/tcp -> 0.0.0.0:32769
```

### 다양한 EXPOSE 사용 예시

### **웹 애플리케이션**

```docker
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

*# HTTP 포트*
EXPOSE 3000

*# HTTPS 포트 (사용한다면)*
EXPOSE 3443

CMD ["npm", "start"]
```

### **데이터베이스**

```docker
FROM postgres:15

*# PostgreSQL 기본 포트*
EXPOSE 5432

*# 관리 도구 포트 (필요시)*
EXPOSE 5433
```

### **여러 프로토콜**

```docker
FROM ubuntu

*# HTTP (TCP)*
EXPOSE 80/tcp

*# DNS (UDP)*
EXPOSE 53/udp

*# SSH (TCP, 기본값)*
EXPOSE 22

*# 프로토콜 미명시 시 TCP가 기본값*
```

### Docker Compose와 EXPOSE

### **services 간 통신**

```yaml
*# docker-compose.yml*
version: '3'
services:
  web:
    build: .
    ports:
      - "8080:3000"  *# 외부 접근용*
    depends_on:
      - db
  
  db:
    image: postgres:15
    *# EXPOSE 5432는 Dockerfile에 있음# 외부 포트 매핑 없이도 web 서비스에서 접근 가능*
    environment:
      POSTGRES_PASSWORD: password

web 컨테이너에서 db 접근:
$ curl http://db:5432  *# 서비스명:포트로 접근 가능*
```

### EXPOSE 베스트 프랙티스

### **문서화 목적으로 활용**

```docker
FROM nginx

*# 메인 웹서버 포트*
EXPOSE 80

*# SSL 포트*
EXPOSE 443

*# 상태 체크 포트*
EXPOSE 8080

*# 메트릭 수집 포트*
EXPOSE 9090

*# 각 포트의 용도를 주석으로 명시하면 더 좋음*
```

### **환경별 포트 설정**

```docker
FROM node:18
WORKDIR /app

*# 개발환경 기본 포트*
EXPOSE 3000

*# 프로덕션에서는 다른 포트 사용 가능# docker run -p 80:3000 (EXPOSE와 무관하게 동작)*
```

### 실무에서의 EXPOSE 활용

### **마이크로서비스**

```docker
*# API Gateway*
FROM node:18
EXPOSE 8080
EXPOSE 8443

*# User Service*  
FROM node:18
EXPOSE 3001

*# Order Service*
FROM node:18  
EXPOSE 3002

*# 각 서비스의 포트를 명확히 문서화*
```

### **모니터링과 함께**

```docker
FROM my-app:latest

*# 애플리케이션 포트*
EXPOSE 8080

*# 헬스체크 포트*
EXPOSE 8081

*# 메트릭 포트*  
EXPOSE 9090

HEALTHCHECK --interval=30s CMD curl -f http://localhost:8081/health
```

### 주의사항

```
흔한 오해들:

❌ "EXPOSE하면 포트가 열린다"
✅ EXPOSE는 문서화일 뿐, 실제 포트 매핑은 -p 옵션 필요

❌ "EXPOSE 없으면 컨테이너 접근 불가"  
✅ -p 옵션만 있으면 EXPOSE 없어도 접근 가능

❌ "EXPOSE가 보안을 제공한다"
✅ EXPOSE는 보안 기능 없음, 방화벽/네트워크 정책 별도 필요

올바른 사용:
- 문서화 목적으로 항상 포함
- docker run -P 옵션 활용시 유용
- Docker Compose에서 포트 정보 참조용
```